{{ define "header"}}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.5.0/semantic.min.css"
      integrity="sha512-KXol4x3sVoO+8ZsWPFI/r5KBVB/ssCGB5tsv2nVOKwLg33wTFP3fmnXa47FdSVIshVTgsYk/1734xSk9aFIa4A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script
      src="https://unpkg.com/htmx.org@1.9.4"
      integrity="sha384-zUfuhFKKZCbHTY6aRR46gxiqszMk5tcHjsVFxnUo8VMus4kHGVdIYVbOYYNlKmHV"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    {{ end }}

    <!---->

    {{define "footer"}}
  </body>
</html>
{{ end }}

<!---->
{{ define "home" }} 
  {{template "header" .}} 
    {{ if .User }}
      {{template "logged-in" . }}
    {{ else }} 
      {{ template "login-form"}}
    {{ end }} 
  {{ template "footer" .}} 
{{ end }}

<!-- -->

{{ define "login-form" }}
<div
  style="
    position: relative;
    max-width: 800px;
    margin: auto;
    top: 50%;
    transform: translateY(-50%);
  "
  class="ui middle aligned center aligned grid"
>
  <div class="column">
    <h2 class="ui teal image header">
      <div class="content">Log-in to your account</div>
    </h2>
    <form class="ui large form" method="POST" action="/login">
      <div class="ui stacked segment">
        <div class="field">
          <div class="ui left icon input">
            <i class="user icon"></i>
            <input type="text" name="email" placeholder="E-mail address" />
          </div>
        </div>
        <div class="field">
          <div class="ui left icon input">
            <i class="lock icon"></i>
            <input type="password" name="password" placeholder="Password" />
          </div>
        </div>
        <button class="ui fluid large teal submit button">Login</button>
      </div>

      <div class="ui error message"></div>
    </form>

    <div class="ui message">New to us? <a href="/signup">Sign Up</a></div>
  </div>
</div>
{{ end }}

<!---->

{{ define "signup" }}
{{ template "header" . }}

<div
  style="
    position: relative;
    max-width: 800px;
    margin: auto;
    top: 50%;
    transform: translateY(-50%);
  "
  class="ui middle aligned center aligned grid"
>
  <div class="column">
    <h2 class="ui teal image header">
      <div class="content">Log-in to your account</div>
    </h2>
    <form class="ui large form" method="POST" action="/signup">
      <div class="ui stacked segment">
        <div class="field">
          <div class="ui left icon input">
            <i class="user icon"></i>
            <input type="text" name="username" placeholder="User name" />
          </div>
        </div>
        <div class="field">
          <div class="ui left icon input">
            <i class="user icon"></i>
            <input type="email" name="email" placeholder="E-mail address" />
          </div>
        </div>
        <div class="field">
          <div class="ui left icon input">
            <i class="lock icon"></i>
            <input type="password" name="password" placeholder="Password" />
          </div>
        </div>
        <button class="ui fluid large teal submit button">Sign Up</button>
      </div>

      <div class="ui error message"></div>
    </form>

    <div class="ui message">
      Already have an account? <a href="/">log in</a>
    </div>
  </div>
</div>

{{ template "footer" . }}
{{ end }}

<!-- -->

{{ define "logged-in"}}

<form method="POST" action="/logout">
  <button>Log Out</button>
</form>

<div
  style="
    position: relative;
    max-width: 800px;
    margin: auto;
    top: 50%;
    transform: translateY(-50%);
  "
  class="container"
>
  <h1>{{.User.Name}}'s Todos</h1>

  <div id="todos" class="ui divided items">
    {{ range .Todos }} 
      {{ template "todo" .}}
    {{ end }}</div>
  <form hx-post="/todo/add" hx-trigger="submit" hx-target="#todos" hx-swap="beforeend">
    <input type="text" name="description" />
    <input class="ui button" type="submit" value="Submit" />
  </form>
</div>
{{ end }}

<!---->

{{ define "todo" }}
<div id="todo-{{.ID}}" style="display: flex; gap: 1rem">
  <div>{{.Description}}</div>
  <div style="display: flex; gap: 1rem">
    <button class="ui button" hx-post="/todo/update/status/{{.ID}}" hx-target="#todo-{{.ID}}" hx-swap="outerHTML">
      {{ if .IsComplete }}
       Completed
      {{ else }}
       Complete
      {{ end }}
    </button>
    <button class="ui button" hx-post="/todo/remove/{{.ID}}" hx-target="#todo-{{.ID}}" hx-swap="delete">Remove</button>
  </div>
</div>
{{ end }}
